let selectedFilters={};function getAllKeys(e){const t=new Set;return e.forEach(e=>{Object.keys(e).forEach(e=>t.add(e))}),Array.from(t)}function getUniqueValues(e,t){const r=new Set;return e.forEach(e=>{e[t]&&r.add(e[t])}),Array.from(r)}function openFilterModal(){0<document.querySelector("#list-tab").children.length||populateFilterOptions(),updateCheckboxStates(),updateClearFiltersButtonStyle()}function updateCheckboxStates(){var e=document.getElementById("nav-tabContent");Array.from(e.children).forEach(e=>{const r=e.id.replace("list-","").replace(/-/g," ");e.querySelectorAll('input[type="checkbox"]').forEach(e=>{var t=e.id,t=e.dataset.filterValue||t.split("filter-checkbox-")[1].split("-").slice(1).join("-"),t=selectedFilters[r]&&selectedFilters[r].includes(t),e=(e.checked=t,e.nextElementSibling);t?e.style.fontWeight="bold":(e.style.fontWeight="normal",e.style.background="none")})})}function populateTabValues(l,s){if(s){const d=l.replace(/ /g,"-");var e=getUniqueValues(productsData.productDirectory,l);s.innerHTML="",e.forEach((e,t)=>{var r=document.createElement("div"),c=(r.className="form-check",document.createElement("input")),o=(c.type="checkbox",c.className="form-check-input me-1",e.replace(/ /g,"-")),o=`filter-checkbox-${d}-`+o,a=(c.id=o,c.dataset.filterKey=l,c.dataset.filterValue=e,selectedFilters[l]&&selectedFilters[l].includes(e)),n=(c.checked=a,c.addEventListener("change",function(e){updateSelectedFilters(this.dataset.filterKey,this.dataset.filterValue)}),document.createElement("label"));n.className="form-check-label",n.setAttribute("for",o),n.textContent=e,a&&(n.style.fontWeight="bold"),r.appendChild(c),r.appendChild(n),s.appendChild(r)})}else console.error("Tab pane is null for key:",l)}function populateFilterOptions(){const a=document.getElementById("list-tab"),n=document.getElementById("nav-tabContent");a.innerHTML="",n.innerHTML="",getAllKeys(productsData.productDirectory).forEach((r,e)=>{if("Product"!==r&&"Group Alias"!==r&&"Prod. Category"!==r){var t=r.replace(/ /g,"-"),c=document.createElement("a");c.classList.add("list-group-item","list-group-item-action"),0===e&&c.classList.add("active"),c.id=`list-${t}-list`,c.setAttribute("data-bs-toggle","list"),c.href="#list-"+t,c.role="tab",c.setAttribute("aria-controls","list-"+t),c.textContent=r,c.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),a.querySelectorAll(".active").forEach(e=>{e.classList.remove("active")}),n.querySelectorAll(".active, .show").forEach(e=>{e.classList.remove("active","show")}),this.classList.add("active");var e=this.getAttribute("href"),t=document.querySelector(e);t?(t.classList.add("active","show"),populateTabValues(r,t)):console.error("Target pane not found:",e)}),a.appendChild(c);const o=document.createElement("div");o.classList.add("tab-pane","fade"),0===e&&o.classList.add("show","active"),o.id="list-"+t,o.role="tabpanel",o.setAttribute("aria-labelledby",`list-${t}-list`),n.appendChild(o),0===e&&setTimeout(()=>populateTabValues(r,o),0)}})}function updateSelectedFilters(e,t){selectedFilters[e]||(selectedFilters[e]=[]);var r=selectedFilters[e].indexOf(t),r=(-1<r?(selectedFilters[e].splice(r,1),0===selectedFilters[e].length&&delete selectedFilters[e]):selectedFilters[e].push(t),document.getElementById("nav-tabContent"));Array.from(r.children).forEach(e=>{var t=e.id.replace("list-","").replace(/-/g," ");e.classList.contains("active")&&populateTabValues(t,e)}),updateClearFiltersButtonStyle()}function applyFilters(){0===Object.keys(selectedFilters).length?(displayProducts(productsData.productDirectory),updateCheckboxStates(),updateClearFiltersButtonStyle()):displayProducts(filterProductsBySelectedFilters(selectedFilters))}function clearFilters(){selectedFilters={},updateCheckboxStates(),updateClearFiltersButtonStyle(),applyFilters()}function filterProductsBySelectedFilters(r){return productsData.productDirectory.filter(e=>{for(const t in r)if(!r[t].includes(String(e[t])))return!1;return!0})}function updateClearFiltersButtonStyle(){var e=document.getElementById("filterProductList"),t=document.getElementById("clearFilters");0<Object.keys(selectedFilters).length?(e.style.backgroundColor="darkblue",t.style.backgroundColor="black",t.style.color="white"):(e.style.backgroundColor="",t.style.backgroundColor="",t.style.color="")}let currentFocusIndex=-1;document.addEventListener("keydown",function(e){var t=document.getElementById("search-box"),r=document.getElementById("filter-modal"),c=document.getElementById("order-modal"),o=document.getElementById("help-modal"),r=r.classList.contains("show"),c=c.classList.contains("show"),o=o.classList.contains("show");r||c||o?c?/^[0-9]$/.test(e.key)?(e.preventDefault(),appendToQuantity(e.key)):"Backspace"===e.key?(e.preventDefault(),clearLastDigit()):"Delete"===e.key?(e.preventDefault(),document.getElementById("clearAllDigits").click()):"Enter"===e.key&&(e.preventDefault(),document.getElementById("addToOrder").click()):e.preventDefault():e.ctrlKey&&e.shiftKey&&("f"===e.key||"F"===e.key)?(e.preventDefault(),document.getElementById("filterProductList").click()):e.ctrlKey&&e.shiftKey&&("o"===e.key||"O"===e.key)?(e.preventDefault(),document.getElementById("clearFilters").click()):e.ctrlKey&&"Delete"===e.key?(e.preventDefault(),clearOrder()):e.ctrlKey&&"Backspace"===e.key?(e.preventDefault(),document.getElementById("clearSearch").click()):e.ctrlKey&&"Enter"===e.key?(e.preventDefault(),sendOrder()):!e.ctrlKey||"c"!==e.key&&"C"!==e.key?!e.ctrlKey||"/"!==e.key&&"?"!==e.key?(/^[a-zA-Z0-9]$/.test(e.key)&&(e.preventDefault(),r=t.selectionStart,t.focus(),t.value=t.value.slice(0,r)+e.key+t.value.slice(r),t.setSelectionRange(r+1,r+1),o=new Event("input",{bubbles:!0}),t.dispatchEvent(o)),"Backspace"===e.key&&(e.preventDefault(),0<(c=t.selectionStart)&&(t.focus(),t.value=t.value.slice(0,c-1)+t.value.slice(c),t.setSelectionRange(c-1,c-1)),resetFocus(),r=new Event("input",{bubbles:!0}),t.dispatchEvent(r)),"Delete"===e.key&&(e.preventDefault(),(o=t.selectionStart)<t.value.length&&(t.focus(),t.value=t.value.slice(0,o)+t.value.slice(o+1)),t.setSelectionRange(o,o),c=new Event("input",{bubbles:!0}),t.dispatchEvent(c)),r=document.getElementById("product-list"),o=Array.from(r.children).filter(e=>"none"!==getComputedStyle(e).display),"ArrowDown"!==e.key&&"ArrowUp"!==e.key||(e.preventDefault(),"ArrowDown"===e.key&&(-1===currentFocusIndex?(currentFocusIndex=1,o[0]?.classList.add("focus"),o[0]?.scrollIntoView({block:"nearest"}),o[0]?.focus?.()):0<currentFocusIndex&&currentFocusIndex<=o.length&&(o[currentFocusIndex-1]?.classList.remove("focus"),currentFocusIndex<o.length&&(o[currentFocusIndex]?.classList.add("focus"),o[currentFocusIndex]?.scrollIntoView({block:"nearest"})),currentFocusIndex++)),"ArrowUp"===e.key&&(1===currentFocusIndex?(o[0]?.classList.remove("focus"),t.focus(),currentFocusIndex=-1):1<currentFocusIndex&&(o[currentFocusIndex-1]?.classList.remove("focus"),o[currentFocusIndex-2]?.classList.add("focus"),o[currentFocusIndex-2]?.scrollIntoView({block:"nearest"}),currentFocusIndex--))),"Enter"===e.key&&0<currentFocusIndex&&(e.preventDefault(),o[currentFocusIndex-1]?.click())):(e.preventDefault(),document.getElementById("helpButton").click()):(e.preventDefault(),copyOrder())}),window.onload=loadProducts();let productsData,openedProductForOrder;async function loadProducts(){try{var e=await fetch("products.json");displayProducts((productsData=await e.json()).productDirectory)}catch(e){console.error("Error loading products:",e)}}function displayProducts(e){var t=document.getElementById("product-list");t.innerHTML="";const a=document.createDocumentFragment();e.forEach(e=>{const t=document.createElement("li");t.classList.add("list-group-item","list-group-item-action"),t.setAttribute("data-bs-toggle","modal"),t.setAttribute("data-bs-target","#order-modal"),t.dataset.productName=e.Product,t.dataset.productType=e["Product Type"],t.dataset.productGroup=e["Group Name"],t.dataset.productGroupAlias=e["Group Alias"],t.dataset.productCategory=e["Prod. Category"],t.dataset.faceType=e["Face Type"]||"",t.dataset.coreType=e["Core Type"],t.dataset.gradeType=e["Grade Type"],t.dataset.brandMark=e["Brand Mark"];var r=document.createElement("input"),c=(r.classList.add("form-check-input","me-2"),r.type="checkbox","checkbox-"+e.Product.replace(/\s/g,"-")),o=(r.id=c,document.createElement("label"));o.classList.add("form-check-label","fs-6","fw-semibold","stretched-link"),o.textContent=e.Product,o.setAttribute("for",c),t.appendChild(r),t.appendChild(o),t.onclick=()=>openOrderModal(t),a.appendChild(t)}),t.appendChild(a)}function openOrderModal(e){document.getElementById("modal-product-name").textContent=e.dataset.productName,document.getElementById("modal-product-type").innerHTML="<b>Product Type :</b> "+e.dataset.productType,document.getElementById("modal-face-type").innerHTML="<b>Face Type :</b> "+e.dataset.faceType,document.getElementById("modal-core-type").innerHTML="<b>Core Type :</b> "+e.dataset.coreType,document.getElementById("modal-grade-type").innerHTML="<b>Grade Type :</b> "+e.dataset.gradeType,document.getElementById("modal-brand-mark").innerHTML="<b>Brand Mark :</b> "+e.dataset.brandMark,openedProductForOrder=e}let selectedProducts=[];const quantityInput=document.getElementById("quantity"),selectedProductsTextarea=document.getElementById("selected-products");function appendToQuantity(e){var t=document.getElementById("quantity");"0"===t.value?t.value=e:t.value+=e}function clearLastDigit(){var e=document.getElementById("quantity"),t=e.value;1<t.length?e.value=t.slice(0,-1):e.value="0"}function clearAllDigits(){document.getElementById("quantity").value="0"}function addToOrder(){const t=openedProductForOrder.dataset.productName;var e=openedProductForOrder.dataset.productGroup,r=openedProductForOrder.dataset.productGroupAlias,c=openedProductForOrder.dataset.productCategory,o=parseInt(quantityInput.value,10),a=document.getElementById("checkbox-"+t.replace(/\s/g,"-")),e={productName:t,productGroup:e,productGroupAlias:r,productCategory:c,quantity:o};0<o?(-1<(r=selectedProducts.findIndex(e=>e.productName===t))?selectedProducts[r]=e:selectedProducts.push(e),a.checked=!0,clearAllDigits()):(selectedProducts=selectedProducts.filter(e=>e.productName!==t),a.checked=!1),updateOrderList()}function clearOrder(){document.querySelectorAll('#product-list input[type="checkbox"]').forEach(e=>e.checked=!1),selectedProducts=[],updateOrderList(),clearSearch()}function updateOrderList(){var e=selectedProducts.map(e=>e.productName+" - "+e.quantity);selectedProductsTextarea.value=e.join("\n")+(`
Total: `+calculateTotalQuantity()),selectedProductsTextarea.scrollTop=selectedProductsTextarea.scrollHeight}function calculateTotalQuantity(){return selectedProducts.reduce((e,t)=>e+t.quantity,0)}const searchBox=document.getElementById("search-box");function scrollSearchBoxToTop(){var e=searchBox.getBoundingClientRect().top+window.scrollY;window.scrollTo({top:e-15,behavior:"smooth"})}function isMobileDevice(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||window.innerWidth<=768}function debounce(t,r){let c;return function(...e){clearTimeout(c),c=setTimeout(()=>{clearTimeout(c),t(...e)},r)}}function clearSearch(){searchBox.value="",filterProducts(),resetFocus()}function parseSearchInput(e){var t=e.lastIndexOf("-");if(-1!==t){var r=e.substring(0,t).trim().replace(/-/g,""),t=e.substring(t+1).trim(),c=parseInt(t,10);if(!isNaN(c)&&0<c&&/^\d+$/.test(t))return{searchTerm:r,quantity:c,isValid:!0}}return{searchTerm:e.trim().replace(/-/g,""),quantity:null,isValid:!1}}function getFirstVisibleProduct(){var e=document.getElementById("product-list");return Array.from(e.getElementsByTagName("li")).find(e=>"none"!==e.style.display)}function filterProducts(){var e=parseSearchInput(searchBox.value)["searchTerm"],t=e.toUpperCase(),r=document.getElementById("product-list").getElementsByTagName("li");let c=!1;for(let e=0;e<r.length;e++)containsInOrder(r[e].dataset.productName.toUpperCase(),t)?(r[e].style.display="",c=!0):r[e].style.display="none";if(!c)for(let e=0;e<r.length;e++){var o=r[e].dataset.brandMark?r[e].dataset.brandMark.toUpperCase():"",a=r[e].dataset.coreType?r[e].dataset.coreType.toUpperCase():"",n=r[e].dataset.gradeType?r[e].dataset.gradeType.toUpperCase():"";containsInOrder(o,t)||containsInOrder(a,t)||containsInOrder(n,t)?(r[e].style.display="",c=!0):r[e].style.display="none"}return c}function containsInOrder(t,r){t=t.toUpperCase(),r=r.toUpperCase();let c=0;for(let e=0;e<r.length;e++){if(-1===(c=t.indexOf(r[e],c)))return!1;c++}return!0}function focusFirstVisibleItem(){var e=document.getElementById("product-list"),e=Array.from(e.children).filter(e=>"none"!==getComputedStyle(e).display);0<e.length&&(currentFocusIndex=1,e[0]?.classList.add("focus"),e[0]?.scrollIntoView({block:"nearest"}))}function resetFocus(){document.querySelectorAll(".focus").forEach(e=>{e.classList.remove("focus")})}function hasProducts(e){return 0!==e.length||(console.warn("No products in the order. Please add products to the order."),!1)}function sortProducts(e){return e.sort((e,t)=>{var r,c=e.productGroupAlias.localeCompare(t.productGroupAlias);return 0===c?0===(r=e.productCategory.localeCompare(t.productCategory))?e.productName.localeCompare(t.productName):r:c})}function generateOrderText(e){let o="",a=null;e.forEach(e=>{var{productGroupAlias:e,productName:t,productGroup:r,quantity:c}=e;a!==e&&(o+=`
*${r}* :
`,a=e),o+=t+` - ${c}
`});e=calculateTotalQuantity();return o+=`
Total : *${e}* Pcs.
`}function sendOrder(){var e;hasProducts(selectedProducts)&&(e=generateOrderText(sortProducts(selectedProducts)),e=encodeURIComponent(e),window.open("https://wa.me/+916355360702?text="+e,"_blank"))}function copyOrder(){var e;hasProducts(selectedProducts)&&(e=generateOrderText(sortProducts(selectedProducts)),navigator.clipboard.writeText(e))}searchBox.addEventListener("focus",()=>{scrollSearchBoxToTop()}),searchBox.addEventListener("input",()=>{scrollSearchBoxToTop(),currentFocusIndex=-1,isMobileDevice()||focusFirstVisibleItem()}),searchBox.addEventListener("input",debounce(()=>{var e,t=parseSearchInput(searchBox.value);t.searchTerm?(e=filterProducts(),t.isValid&&null!==t.quantity&&e&&(e=getFirstVisibleProduct())&&(openedProductForOrder=e,document.getElementById("quantity").value=t.quantity.toString(),addToOrder(),searchBox.value=t.searchTerm,filterProducts())):(resetFocus(),filterProducts())},1e3));