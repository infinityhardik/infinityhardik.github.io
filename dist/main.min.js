const animations={buttonLoading:e=>{e.classList.add("loading"),e.setAttribute("disabled",!0)},buttonLoadingDone:e=>{e.classList.remove("loading"),e.removeAttribute("disabled")},showSkeletonLoading:(e,t=5)=>{var r=document.createDocumentFragment();for(let e=0;e<t;e++){var o=document.createElement("div");o.className="skeleton-loader",r.appendChild(o)}e.appendChild(r)},removeSkeletonLoading:e=>{e.querySelectorAll(".skeleton-loader").forEach(e=>e.remove())},initLazyLoading:()=>{const t=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&(e.target.classList.add("product-item"),t.unobserve(e.target))})},{root:null,rootMargin:"50px",threshold:.1});document.querySelectorAll(".list-group-item").forEach(e=>{t.observe(e)})},optimizeForDevice:()=>{var e=window.matchMedia("(prefers-reduced-motion: reduce)").matches,t=window.matchMedia("(max-width: 768px)").matches;(e||t)&&(document.documentElement.style.setProperty("--animation-duration","0.2s"),document.body.classList.add("reduced-motion"))},initTouchFeedback:()=>{document.querySelectorAll(".btn, .list-group-item").forEach(e=>{e.addEventListener("touchstart",()=>{e.style.transform="scale(0.98)"}),e.addEventListener("touchend",()=>{e.style.transform=""})})},init:()=>{animations.optimizeForDevice(),animations.initLazyLoading(),animations.initTouchFeedback(),document.querySelectorAll(".btn").forEach(t=>{const r=t.onclick;t.onclick=async e=>{animations.buttonLoading(t),r&&await r(e),animations.buttonLoadingDone(t)}});["filterProductList","clearFilters","clearOrder","sendOrder","darkModeToggle","showSelectedOnly","clearSearch","helpButton","copyOrder1","sendOrder1","clearOrder1","floating-order-button"].forEach(e=>{e=document.getElementById(e);e&&e.addEventListener("click",()=>{navigator.vibrate&&navigator.vibrate([50])})})}};document.addEventListener("DOMContentLoaded",animations.init);let selectedFilters={};function getAllKeys(e){const t=new Set;return e.forEach(e=>{Object.keys(e).forEach(e=>t.add(e))}),Array.from(t)}function getUniqueValues(e,t){const r=new Set;return e.forEach(e=>{void 0!==e[t]&&null!==e[t]&&""!==e[t]&&r.add(String(e[t]).trim())}),Array.from(r).sort()}function openFilterModal(){productsData&&productsData.productDirectory&&0<productsData.productDirectory.length&&populateFilterOptions(),updateFilterCheckboxStates(),resetFocus()}function populateTabContentForCategory(c,d){var e;0<d.children.length?updateFilterCheckboxStates():0===(e=getUniqueValues(productsData.productDirectory,c)).length?d.innerHTML='<p class="text-muted">No options available</p>':(e.forEach(e=>{var t=document.createElement("div"),r=(t.classList.add("form-check","mb-2"),document.createElement("input")),o=(r.classList.add("form-check-input","filter-checkbox"),r.type="checkbox",r.value=e,r.id=`filter-${c.replace(/[\s\.]/g,"-")}-`+e.replace(/[\s\.]/g,"-"),r.dataset.filterKey=c,document.createElement("label"));o.classList.add("form-check-label"),o.htmlFor=r.id,o.textContent=e,t.appendChild(r),t.appendChild(o),d.appendChild(t),r.addEventListener("change",e=>{var t=e.target.dataset.filterKey;const r=e.target.value;e.target.checked?(selectedFilters[t]||(selectedFilters[t]=[]),selectedFilters[t].includes(r)||selectedFilters[t].push(r)):selectedFilters[t]&&(selectedFilters[t]=selectedFilters[t].filter(e=>e!==r),0===selectedFilters[t].length)&&delete selectedFilters[t],updateClearFiltersButtonStyle()})}),updateFilterCheckboxStates())}function populateFilterOptions(){const r=document.getElementById("list-tab"),o=document.getElementById("nav-tabContent");if(r&&o){r.innerHTML="";var t={"Product Type":"Product Type","Group Name":"Group Name","Prod. Category":"Product Category","Face Type":"Face Type","Core Type":"Core Type","Grade Type":"Grade Type","Brand Mark":"Brand Mark"};let e=!(o.innerHTML="");for(const a in t){var c=t[a];if(0<getUniqueValues(productsData.productDirectory,a).length){var d=`list-${a.replace(/[\s\.]/g,"-")}-list`;const n=a.replace(/[\s\.]/g,"-")+"-tab-pane",s=document.createElement("button");s.classList.add("list-group-item","list-group-item-action"),e&&(s.classList.add("active"),s.setAttribute("aria-current","true")),s.id=d,s.dataset.bsToggle="list",s.dataset.bsTarget="#"+n,s.type="button",s.role="tab",s.setAttribute("aria-controls",n),s.textContent=c,s.dataset.filterKey=a,r.appendChild(s);c=document.createElement("div");c.classList.add("tab-pane","fade"),e&&c.classList.add("show","active"),c.id=n,c.role="tabpanel",c.setAttribute("aria-labelledby",d),o.appendChild(c),s.addEventListener("click",e=>{e.preventDefault(),r.querySelectorAll(".list-group-item").forEach(e=>{e.classList.remove("active"),e.removeAttribute("aria-current")}),o.querySelectorAll(".tab-pane").forEach(e=>{e.classList.remove("show","active")}),s.classList.add("active"),s.setAttribute("aria-current","true");var t,e=document.getElementById(n);e&&(e.classList.add("show","active"),t=s.dataset.filterKey)&&populateTabContentForCategory(t,e)}),e&&(populateTabContentForCategory(a,c),e=!1)}}updateClearFiltersButtonStyle()}else console.error("Filter modal elements not found")}function updateFilterCheckboxStates(){document.querySelectorAll(".filter-checkbox").forEach(e=>{var t=e.dataset.filterKey,r=e.value,t=selectedFilters[t]&&selectedFilters[t].includes(r),r=(e.checked=t,e.nextElementSibling);r&&(t?(r.style.fontWeight="bold",r.style.color="#0d6efd"):(r.style.fontWeight="normal",r.style.color=""))})}function applyFilters(){let e=productsData.productDirectory;for(const o in selectedFilters)if(selectedFilters.hasOwnProperty(o)&&0<selectedFilters[o].length){const c=selectedFilters[o];e=e.filter(e=>{e=e[o];return null!=e&&c.includes(String(e).trim())})}displayProducts(e),resetFocus();var t=Object.keys(selectedFilters).length,r=e.length;0<t&&displayFeedbackMessage(`Applied ${t} filter(s). Showing ${r} product(s).`,"info")}function clearFilters(){selectedFilters={},document.querySelectorAll(".filter-checkbox").forEach(e=>{e.checked=!1;e=e.nextElementSibling;e&&(e.style.fontWeight="normal",e.style.color="")}),displayProducts(productsData.productDirectory),updateClearFiltersButtonStyle(),resetFocus(),"function"==typeof displayFeedbackMessage&&displayFeedbackMessage("Filters cleared. Showing all products.","success")}function filterProductsBySelectedFilters(o){return productsData.productDirectory.filter(e=>{for(const r in o)if(o.hasOwnProperty(r)&&0<o[r].length){var t=e[r];if(null==t||!o[r].includes(String(t).trim()))return!1}return!0})}function updateClearFiltersButtonStyle(){var e=document.getElementById("filterProductList"),t=document.getElementById("clearFilters"),r=0<Object.keys(selectedFilters).length,o=Object.keys(selectedFilters).reduce((e,t)=>e+(selectedFilters[t]?selectedFilters[t].length:0),0);e&&(r?(e.style.backgroundColor="#0d6efd",e.style.borderColor="#0d6efd",e.style.color="white",e.textContent=`Filter (${o})`):(e.style.backgroundColor="",e.style.borderColor="",e.style.color="",e.textContent="Filter")),t&&(r?(t.style.backgroundColor="#dc3545",t.style.borderColor="#dc3545",t.style.color="white",t.style.display="inline-block"):(t.style.backgroundColor="",t.style.borderColor="",t.style.color="",t.style.display="none"))}document.addEventListener("DOMContentLoaded",function(){var e=document.getElementById("filterModal");e&&e.addEventListener("shown.bs.modal",openFilterModal),updateClearFiltersButtonStyle()});let currentFocusIndex=-1;function focusFirstVisibleItem(){var e=document.getElementById("product-list"),e=Array.from(e.children);resetFocus(),0<e.length?(e[currentFocusIndex=0].classList.add("focus"),e[0].scrollIntoView({block:"nearest",behavior:"smooth"})):currentFocusIndex=-1}function validatePointerAfterListChange(){var e=document.getElementById("product-list"),e=Array.from(e.children);currentFocusIndex>=e.length&&(resetFocus(),0<e.length)&&(e[currentFocusIndex=0].classList.add("focus"),e[0].scrollIntoView({block:"nearest",behavior:"smooth"}))}document.addEventListener("keydown",function(e){var t=document.getElementById("search-box"),r=document.getElementById("filter-modal"),o=document.getElementById("order-modal"),c=document.getElementById("help-modal"),d=document.getElementById("order-text-popup"),r=r.classList.contains("show"),o=o.classList.contains("show"),c=c.classList.contains("show"),d=d.classList.contains("show");if(r||o||c||d)o?"Escape"===e.key&&(e.preventDefault(),document.querySelector("#order-modal .btn-close").click()):d&&("Escape"!==e.key&&(!e.ctrlKey||e.shiftKey||"o"!==e.key&&"O"!==e.key)?!e.ctrlKey||"c"!==e.key&&"C"!==e.key?e.ctrlKey&&"Delete"===e.key?(e.preventDefault(),clearOrder()):e.ctrlKey&&"Enter"===e.key&&(e.preventDefault(),sendOrder()):(e.preventDefault(),copyOrder()):(e.preventDefault(),toggleOrderPopup()));else if(e.ctrlKey&&e.shiftKey&&("f"===e.key||"F"===e.key))e.preventDefault(),document.getElementById("filterProductList").click();else if(e.ctrlKey&&e.shiftKey&&("o"===e.key||"O"===e.key))e.preventDefault(),document.getElementById("clearFilters").click();else if(e.ctrlKey&&"Delete"===e.key)e.preventDefault(),clearOrder();else if(e.ctrlKey&&"Backspace"===e.key)e.preventDefault(),clearSearch();else if(e.ctrlKey&&"Enter"===e.key)e.preventDefault(),sendOrder();else if(!e.ctrlKey||"c"!==e.key&&"C"!==e.key)if(!e.ctrlKey||"/"!==e.key&&"?"!==e.key)if(!e.ctrlKey||e.shiftKey||"o"!==e.key&&"O"!==e.key)if(!e.ctrlKey||"s"!==e.key&&"S"!==e.key){!/^[a-zA-Z0-9]$/.test(e.key)&&"-"!==e.key&&" "!==e.key||document.activeElement===t||(t.focus(),t.setSelectionRange(t.value.length,t.value.length)),"Backspace"===e.key&&document.activeElement!==t&&(e.preventDefault(),t.focus(),t.setSelectionRange(t.value.length,t.value.length)),"Delete"===e.key&&document.activeElement;var r=document.getElementById("product-list"),c=Array.from(r.children);if(e.ctrlKey&&("ArrowUp"===e.key||"ArrowRight"===e.key)&&0<=currentFocusIndex&&currentFocusIndex<c.length)e.preventDefault(),(o=c[currentFocusIndex].dataset.productName)&&updateProductQuantityInOrder(o,1);else if(e.ctrlKey&&("ArrowDown"===e.key||"ArrowLeft"===e.key)&&0<=currentFocusIndex&&currentFocusIndex<c.length)e.preventDefault(),(d=c[currentFocusIndex].dataset.productName)&&updateProductQuantityInOrder(d,-1);else{if("ArrowDown"===e.key||"ArrowUp"===e.key){if(e.preventDefault(),0===c.length)return currentFocusIndex=-1,void t.focus();c.forEach(e=>e.classList.remove("focus","keyboard-focus")),document.activeElement===t&&(currentFocusIndex=-1),"ArrowDown"===e.key&&(-1===currentFocusIndex?(currentFocusIndex=0,t.blur()):currentFocusIndex<c.length-1&&currentFocusIndex++,0<=currentFocusIndex)&&currentFocusIndex<c.length&&(c[currentFocusIndex].classList.add("focus","keyboard-focus"),c[currentFocusIndex].scrollIntoView({block:"nearest",behavior:"smooth"})),"ArrowUp"===e.key&&(currentFocusIndex<=0?(c[0]&&c[0].classList.remove("focus","keyboard-focus"),t.focus(),currentFocusIndex=-1):0<=--currentFocusIndex&&c[currentFocusIndex]&&(c[currentFocusIndex].classList.add("focus","keyboard-focus"),c[currentFocusIndex].scrollIntoView({block:"nearest",behavior:"smooth"})))}"Enter"===e.key&&(0<=currentFocusIndex&&currentFocusIndex<c.length?(e.preventDefault(),(r=c[currentFocusIndex].querySelector(".product-info"))&&r.click()):document.activeElement===t&&({searchTerm:o,quantity:d,isValid:c}=parseSearchInput(t.value),c)&&null!==d&&(r=getFirstVisibleProductElement())&&(addToOrder(r.dataset.productName,d),filterProductsAndDisplay(t.value=o),resetFocus()))}}else e.preventDefault(),(c=document.getElementById("showSelectedOnly"))&&c.click();else e.preventDefault(),toggleOrderPopup();else e.preventDefault(),document.getElementById("helpButton").click();else e.preventDefault(),copyOrder()});const productListContainer=document.getElementById("product-list");if(productListContainer){const c0=new MutationObserver(()=>{validatePointerAfterListChange()});c0.observe(productListContainer,{childList:!0})}function resetFocus(){document.querySelectorAll(".list-group-item.focus, .list-group-item.keyboard-focus").forEach(e=>{e.classList.remove("focus","keyboard-focus")}),currentFocusIndex=-1}const searchBoxInput=document.getElementById("search-box");searchBoxInput&&searchBoxInput.addEventListener("input",function(){resetFocus();var e=document.getElementById("product-list");e&&Array.from(e.children).forEach(e=>e.classList.remove("focus","keyboard-focus"))}),window.onload=()=>{loadProducts(),applySavedTheme()};let productsData={productDirectory:[]},openedProductForOrder=null,holdTimer=null,holdInterval=null;const HOLD_DELAY=300,REPEAT_INTERVAL=100;async function loadProducts(){try{var e=await fetch("products.json");if(!e.ok)throw new Error("HTTP error! status: "+e.status);displayProducts((productsData=await e.json()).productDirectory),updateOrderList()}catch(e){console.error("Error loading products:",e)}}function displayProducts(e){const m=document.getElementById("product-list");var t=Array.from(m.children);e.map(e=>e.Product);const f=new Map,h=(t.forEach(e=>{e.dataset.productName&&f.set(e.dataset.productName,e)}),new Set);e.forEach((t,e)=>{const r=t.Product;var o=f.get(r);if(o){m.children[e]!==o&&m.insertBefore(o,m.children[e]||null);var c=o.querySelector(".product-checkbox"),d=selectedProducts.find(e=>e.productName===r),c=(c&&(c.checked=!!d),d?o.classList.add("added-to-order"):o.classList.remove("added-to-order"),o.querySelector(".quantity-display"));c&&(c.value=d?d.quantity:0)}else{const u=document.createElement("li"),p=(u.classList.add("list-group-item","list-group-item-action","product-item"),u.dataset.productName=t.Product,u.dataset.productType=t["Product Type"],u.dataset.productGroup=t["Group Name"],u.dataset.productGroupAlias=t["Group Alias"],u.dataset.productCategory=t["Prod. Category"],u.dataset.faceType=t["Face Type"]||"",u.dataset.coreType=t["Core Type"],u.dataset.gradeType=t["Grade Type"],u.dataset.brandMark=t["Brand Mark"],document.createElement("input"));p.classList.add("form-check-input","product-checkbox"),p.type="checkbox";o="checkbox-"+t.Product.replace(/\s/g,"-"),c=(p.id=o,p.title="Select "+t.Product,document.createElement("label"));c.setAttribute("for",o),c.classList.add("visually-hidden"),c.textContent="Select "+t.Product;const y=selectedProducts.find(e=>e.productName===t.Product);p.checked=!!y,y&&u.classList.add("added-to-order"),p.addEventListener("change",e=>{e.stopPropagation();e=y?y.quantity:0;p.checked?updateProductQuantityInOrder(t.Product,0===e?1:0):updateProductQuantityInOrder(t.Product,-e)});var d=document.createElement("div"),a=(d.classList.add("product-info"),d.onclick=e=>{e.stopPropagation(),openOrderModal(u)},document.createElement("span")),n=(a.classList.add("product-name"),a.textContent=t.Product,a.setAttribute("title","Click to view details"),document.createElement("div")),s=(n.classList.add("quantity-controls"),document.createElement("button")),l=(s.type="button",s.classList.add("btn","btn-outline-danger","btn-sm","qty-btn"),s.textContent="-",addHoldListeners(s,()=>updateProductQuantityInOrder(t.Product,-1)),document.createElement("input")),i=(l.type="number",l.classList.add("quantity-display","form-control-sm"),l.value=y?y.quantity:0,l.readOnly=!0,l.dataset.productName=t.Product,l.id="quantity-"+t.Product.replace(/\s/g,"-"),l.name="quantity-"+t.Product.replace(/\s/g,"-"),l.title="Quantity for "+t.Product,document.createElement("button"));i.type="button",i.classList.add("btn","btn-outline-success","btn-sm","qty-btn"),i.textContent="+",addHoldListeners(i,()=>updateProductQuantityInOrder(t.Product,1)),n.appendChild(s),n.appendChild(l),n.appendChild(i),d.appendChild(p),d.appendChild(c),d.appendChild(a),d.setAttribute("aria-labelledby",o+" "+a.id),u.appendChild(d),u.appendChild(n),u.addEventListener("click",function(e){e.target.closest(".quantity-controls")||e.target.classList.contains("product-checkbox")||"BUTTON"===e.target.tagName||"INPUT"===e.target.tagName||openOrderModal(u)}),m.insertBefore(u,m.children[e]||null)}h.add(r)}),t.forEach(e=>{h.has(e.dataset.productName)||m.removeChild(e)})}function addHoldListeners(e,t){let r,o;const c=()=>{clearTimeout(r),clearInterval(o),e.classList.add("holding"),t(),r=setTimeout(()=>{o=setInterval(t,REPEAT_INTERVAL)},HOLD_DELAY)};var d=()=>{clearTimeout(r),clearInterval(o),e.classList.remove("holding")};e.addEventListener("mousedown",e=>{0===e.button&&(c(),e.preventDefault())}),e.addEventListener("mouseup",d),e.addEventListener("mouseleave",d),e.addEventListener("touchstart",e=>{e.preventDefault(),c()},{passive:!1}),e.addEventListener("touchend",d),e.addEventListener("touchcancel",d)}function openOrderModal(e){document.getElementById("modal-product-name").textContent=e.dataset.productName,document.getElementById("modal-product-type").innerHTML="<b>Product Type :</b> "+e.dataset.productType,document.getElementById("modal-face-type").innerHTML="<b>Face Type :</b> "+e.dataset.faceType,document.getElementById("modal-core-type").innerHTML="<b>Core Type :</b> "+e.dataset.coreType,document.getElementById("modal-grade-type").innerHTML="<b>Grade Type :</b> "+e.dataset.gradeType,document.getElementById("modal-brand-mark").innerHTML="<b>Brand Mark :</b> "+e.dataset.brandMark,openedProductForOrder=e,new bootstrap.Modal(document.getElementById("order-modal")).show()}function displayFeedbackMessage(e,t="warning",r=3e3){var o=document.getElementById("feedback-message");o&&o.remove();const c=document.createElement("div");c.id="feedback-message",c.classList.add("feedback-message",t),c.textContent=e,document.body.appendChild(c),c.offsetHeight,c.classList.add("show"),setTimeout(()=>{c.classList.remove("show"),setTimeout(()=>{c&&c.parentNode&&c.remove()},500)},r)}function toggleOrderPopup(){var e=document.getElementById("order-text-popup"),t=document.getElementById("selected-products"),r=document.getElementById("floating-order-button");e.classList.contains("show")?(e.classList.remove("show"),r&&(r.style.opacity="1")):(e.classList.add("show"),updateOrderList(),t.scrollTop=t.scrollHeight,r&&(r.style.opacity="0.5"))}function toggleDarkMode(){var e=document.body;e.classList.toggle("dark-mode"),e.classList.contains("dark-mode")?localStorage.setItem("theme","dark"):localStorage.setItem("theme","light"),updateDarkModeToggleIcon()}function applySavedTheme(){"dark"===localStorage.getItem("theme")?document.body.classList.add("dark-mode"):document.body.classList.remove("dark-mode"),updateDarkModeToggleIcon()}function updateDarkModeToggleIcon(){var e=document.getElementById("darkModeToggle");e&&(document.body.classList.contains("dark-mode")?(e.innerHTML="🌙",e.setAttribute("title","Switch to Light Mode")):(e.innerHTML="🌞",e.setAttribute("title","Switch to Dark Mode")))}let selectedProducts=[],selectedProductsTextarea;function updateProductQuantityInOrder(r,o){var c=productsData.productDirectory.find(e=>e.Product===r);if(c){var d=selectedProducts.findIndex(e=>e.productName===r);let e=0,t=(e=-1<d?selectedProducts[d].quantity:e)+o;t<0&&(t=0);const n=document.querySelector(`li[data-product-name="${r}"]`);var o=n?n.querySelector(".quantity-display"):null,a=n?n.querySelector(".product-checkbox"):null;0<t?(c={productName:c.Product,productGroup:c["Group Name"],productGroupAlias:c["Group Alias"],productCategory:c["Prod. Category"],quantity:t},-1<d?selectedProducts[d]=c:selectedProducts.push(c),a&&(a.checked=!0),n&&(n.classList.remove("removed-from-order"),n.classList.add("added-to-order"))):(selectedProducts=selectedProducts.filter(e=>e.productName!==r),a&&(a.checked=!1),n&&(n.classList.remove("added-to-order"),n.classList.add("removed-from-order"),setTimeout(()=>{n.classList.remove("removed-from-order")},300))),o&&(o.value=t,o.title="Quantity for "+r),updateOrderList()}else console.error("Product not found:",r)}function addToOrder(t,e){var r;t&&void 0!==e?(r=(r=selectedProducts.find(e=>e.productName===t))?r.quantity:0,updateProductQuantityInOrder(t,e-r)):console.error("Product name or quantity is missing for addToOrder.")}function clearOrder(e){e&&(e.preventDefault(),e.stopPropagation()),selectedProducts=[],document.querySelectorAll("#product-list .product-item").forEach(e=>{var t=e.querySelector(".product-checkbox"),r=e.querySelector(".quantity-display");t&&(t.checked=!1),r&&(r.value=0),e.classList.remove("added-to-order"),e.classList.remove("removed-from-order")}),void 0!==showSelectedOnly&&showSelectedOnly&&(showSelectedOnly=!1,"function"==typeof updateShowSelectedOnlyButton)&&updateShowSelectedOnlyButton(),updateOrderList(),clearSearch(),displayFeedbackMessage("Order cleared successfully!","success")}function updateOrderList(){if(selectedProductsTextarea||(selectedProductsTextarea=document.getElementById("selected-products"))){var e=sortProducts(selectedProducts);let c="",d=null;e.forEach(e=>{var{productGroupAlias:e,productName:t,productGroup:r,quantity:o}=e;d!==e&&(c+=`
*${r}* :
`,d=e),c+=t+` - ${o}
`});e=calculateTotalQuantity(),e=(c+=`
Total : *${e}* Pcs.
`,selectedProductsTextarea.value=c.trim(),document.getElementById("order-text-popup"));e&&e.classList.contains("show")&&(selectedProductsTextarea.scrollTop=selectedProductsTextarea.scrollHeight)}else console.warn("Order textarea not found in DOM.")}function calculateTotalQuantity(){return selectedProducts.reduce((e,t)=>e+t.quantity,0)}document.addEventListener("DOMContentLoaded",()=>{selectedProductsTextarea=document.getElementById("selected-products")});const searchBox=document.getElementById("search-box");function scrollSearchBoxToTop(){var e=searchBox.getBoundingClientRect().top+window.scrollY;window.scrollTo({top:e-15,behavior:"smooth"})}function isMobileDevice(){return/Android|webOS|iPhone|iPad|IPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||window.innerWidth<=768}function debounce(t,r){let o;return function(...e){clearTimeout(o),o=setTimeout(()=>{clearTimeout(o),t(...e)},r)}}function parseSearchInput(e){var t=e.lastIndexOf("-");if(-1!==t&&t<e.length-1){var r=e.substring(0,t).trim(),t=e.substring(t+1).trim(),o=parseInt(t,10);if(!isNaN(o)&&0<=o&&/^\d+$/.test(t))return{searchTerm:r.replace(/-/g,""),quantity:o,isValid:!0}}return{searchTerm:e.trim().replace(/-/g,""),quantity:null,isValid:!1}}function containsInOrder(e,t){var r=e.toLowerCase(),o=t.toLowerCase();let c=0,d=0;for(;c<r.length&&d<o.length;)r[c]===o[d]&&d++,c++;return d===o.length}function filterProductsAndDisplay(e="",t={}){const c=e.trim().toUpperCase();let r=[];c?0===(r=productsData.productDirectory.filter(e=>{return containsInOrder((e.Product||"").toUpperCase(),c)})).length&&(r=productsData.productDirectory.filter(e=>{var t=(e["Brand Mark"]||"").toUpperCase(),r=(e["Core Type"]||"").toUpperCase(),o=(e["Grade Type"]||"").toUpperCase(),e=(e["Product Type"]||"").toUpperCase();return containsInOrder(t,c)||containsInOrder(r,c)||containsInOrder(o,c)||containsInOrder(e,c)})):r=productsData.productDirectory,displayProducts(r),resetFocus(),t.skipScroll||scrollSearchBoxToTop()}searchBox.addEventListener("focus",()=>{scrollSearchBoxToTop()});let lastDebouncedHandler=null,lastDebounceDelay=null;function dynamicDebounceHandler(){var e=searchBox.value.includes("-")?1e3:0,t=(lastDebouncedHandler&&searchBox.removeEventListener("input",lastDebouncedHandler),debounce(()=>{var{searchTerm:e,quantity:t,isValid:r}=parseSearchInput(searchBox.value);filterProductsAndDisplay(e),r&&null!==t&&(r=getFirstVisibleProductElement())&&(addToOrder(r.dataset.productName,t),searchBox.value=e),isMobileDevice()||focusFirstVisibleItem()},e));searchBox.addEventListener("input",t),lastDebouncedHandler=t,lastDebounceDelay=e}function clearSearch(){filterProductsAndDisplay(searchBox.value=""),resetFocus()}function getFirstVisibleProductElement(){var e=document.getElementById("product-list");return e&&0<e.children.length?e.children[0]:null}function focusFirstVisibleItem(){var e=document.getElementById("product-list"),e=Array.from(e.children);resetFocus(),0<e.length?(currentFocusIndex=1,e[0].classList.add("focus"),e[0].scrollIntoView({block:"nearest",behavior:"smooth"})):currentFocusIndex=-1}function resetFocus(){document.querySelectorAll(".list-group-item.focus").forEach(e=>{e.classList.remove("focus")}),currentFocusIndex=-1}searchBox.addEventListener("input",function(){(searchBox.value.includes("-")?1e3:0)!==lastDebounceDelay&&dynamicDebounceHandler()}),window.addEventListener("DOMContentLoaded",dynamicDebounceHandler);const originalFilterProductsAndDisplay=filterProductsAndDisplay,originalClearSearch=(filterProductsAndDisplay=function(e=""){originalFilterProductsAndDisplay(e),isMobileDevice()||focusFirstVisibleItem()},clearSearch);if("function"==typeof clearFilters){const N1=clearFilters;clearFilters=function(){N1(),isMobileDevice()||focusFirstVisibleItem()}}let showSelectedOnly=!(clearSearch=function(){originalClearSearch(),isMobileDevice()||focusFirstVisibleItem()});const showSelectedOnlyBtn=document.getElementById("showSelectedOnly"),showSelectedOnlyIcon=document.getElementById("showSelectedOnlyIcon");function updateShowSelectedOnlyButton(){showSelectedOnly?(showSelectedOnlyBtn.classList.add("active"),showSelectedOnlyBtn.classList.add("btn-primary"),showSelectedOnlyIcon.textContent="✅"):(showSelectedOnlyBtn.classList.remove("active"),showSelectedOnlyBtn.classList.remove("btn-primary"),showSelectedOnlyIcon.textContent="🔘")}showSelectedOnlyBtn&&showSelectedOnlyBtn.addEventListener("click",function(){showSelectedOnly=!showSelectedOnly,updateShowSelectedOnlyButton(),showSelectedOnly&&(searchBox.value=""),filterProductsAndDisplay(searchBox.value,{skipScroll:!0})});const originalFilterProductsAndDisplay2=filterProductsAndDisplay;if(filterProductsAndDisplay=function(t="",e={}){let r;showSelectedOnly?(displayProducts(r=t.trim()?selectedProducts.map(t=>productsData.productDirectory.find(e=>e.Product===t.productName)).filter(Boolean).filter(e=>e.Product.toUpperCase().includes(t.trim().toUpperCase())):selectedProducts.map(t=>productsData.productDirectory.find(e=>e.Product===t.productName)).filter(Boolean)),resetFocus(),e.skipScroll||scrollSearchBoxToTop(),isMobileDevice()||focusFirstVisibleItem()):originalFilterProductsAndDisplay2(t)},"function"==typeof updateOrderList){const W1=updateOrderList;updateOrderList=function(){W1(),showSelectedOnly&&filterProductsAndDisplay(searchBox.value)}}function hasProducts(e){return 0!==e.length||(displayFeedbackMessage("No products in the order. Please add products.","warning"),!1)}function sortProducts(e){return[...e].sort((e,t)=>{var r,o=e.productGroupAlias.localeCompare(t.productGroupAlias);return 0===o?0===(r=e.productCategory.localeCompare(t.productCategory))?e.productName.localeCompare(t.productName):r:o})}function copyOrder(){if(hasProducts(selectedProducts)){var e=formatOrderText(sortProducts(selectedProducts));if(navigator.clipboard&&navigator.clipboard.writeText)navigator.clipboard.writeText(e).then(()=>{displayFeedbackMessage("Order copied to clipboard!","success")}).catch(e=>{console.error("Failed to copy order text: ",e),displayFeedbackMessage("Failed to copy order. Please try again.","error")});else{var t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.opacity="0",document.body.appendChild(t),t.select();try{if(!document.execCommand("copy"))throw new Error("execCommand failed");displayFeedbackMessage("Order copied to clipboard (fallback)!","success")}catch(e){console.error("Fallback: Failed to copy order text: ",e),displayFeedbackMessage("Failed to copy order. Please try manually.","error")}finally{document.body.removeChild(t)}}}}function sendOrder(){var e;hasProducts(selectedProducts)&&(e=sortProducts(selectedProducts),e=encodeURIComponent(formatOrderText(e)),window.open("https://wa.me/+916355360702?text="+e,"_blank"),displayFeedbackMessage("Order sent via WhatsApp!","success"))}function formatOrderText(e){let c="",d=null;e.forEach(e=>{var{productGroupAlias:e,productName:t,productGroup:r,quantity:o}=e;d!==e&&(c+=`
*${r}* :
`,d=e),c+=t+` - ${o}
`});e=calculateTotalQuantity();return(c+=`
Total : *${e}* Pcs.
`).trim()}