let selectedFilters={};function getAllKeys(e){const t=new Set;return e.forEach((e=>{Object.keys(e).forEach((e=>t.add(e)))})),Array.from(t)}function getUniqueValues(e,t){const r=new Set;return e.forEach((e=>{e[t]&&r.add(e[t])})),Array.from(r)}function openFilterModal(){document.querySelector("#list-tab").children.length>0||populateFilterOptions(),updateCheckboxStates(),updateClearFiltersButtonStyle()}function updateCheckboxStates(){const e=document.getElementById("nav-tabContent");Array.from(e.children).forEach((e=>{const t=e.id.replace("list-","").replace(/-/g," ");e.querySelectorAll('input[type="checkbox"]').forEach((e=>{const r=e.id,o=e.dataset.filterValue||r.split("filter-checkbox-")[1].split("-").slice(1).join("-"),c=selectedFilters[t]&&selectedFilters[t].includes(o);e.checked=c;const n=e.nextElementSibling;c?n.style.fontWeight="bold":(n.style.fontWeight="normal",n.style.background="none")}))}))}function populateTabValues(e,t){if(!t)return void console.error("Tab pane is null for key:",e);const r=e.replace(/ /g,"-"),o=getUniqueValues(productsData.productDirectory,e);t.innerHTML="",o.forEach(((o,c)=>{const n=document.createElement("div");n.className="form-check";const a=document.createElement("input");a.type="checkbox",a.className="form-check-input me-1";const l=o.replace(/ /g,"-"),s=`filter-checkbox-${r}-${l}`;a.id=s,a.dataset.filterKey=e,a.dataset.filterValue=o;const d=selectedFilters[e]&&selectedFilters[e].includes(o);a.checked=d,a.addEventListener("change",(function(e){updateSelectedFilters(this.dataset.filterKey,this.dataset.filterValue)}));const u=document.createElement("label");u.className="form-check-label",u.setAttribute("for",s),u.textContent=o,d&&(u.style.fontWeight="bold"),n.appendChild(a),n.appendChild(u),t.appendChild(n)}))}function populateFilterOptions(){const e=document.getElementById("list-tab"),t=document.getElementById("nav-tabContent");e.innerHTML="",t.innerHTML="";getAllKeys(productsData.productDirectory).forEach(((r,o)=>{if("Product"!==r&&"Group Alias"!==r&&"Prod. Category"!==r){const c=r.replace(/ /g,"-"),n=document.createElement("a");n.classList.add("list-group-item","list-group-item-action"),0===o&&n.classList.add("active"),n.id=`list-${c}-list`,n.setAttribute("data-bs-toggle","list"),n.href=`#list-${c}`,n.role="tab",n.setAttribute("aria-controls",`list-${c}`),n.textContent=r,n.addEventListener("click",(function(o){o.preventDefault(),o.stopPropagation(),e.querySelectorAll(".active").forEach((e=>{e.classList.remove("active")})),t.querySelectorAll(".active, .show").forEach((e=>{e.classList.remove("active","show")})),this.classList.add("active");const c=this.getAttribute("href"),n=document.querySelector(c);n?(n.classList.add("active","show"),populateTabValues(r,n)):console.error("Target pane not found:",c)})),e.appendChild(n);const a=document.createElement("div");a.classList.add("tab-pane","fade"),0===o&&a.classList.add("show","active"),a.id=`list-${c}`,a.role="tabpanel",a.setAttribute("aria-labelledby",`list-${c}-list`),t.appendChild(a),0===o&&setTimeout((()=>populateTabValues(r,a)),0)}}))}function updateSelectedFilters(e,t){selectedFilters[e]||(selectedFilters[e]=[]);const r=selectedFilters[e].indexOf(t);r>-1?(selectedFilters[e].splice(r,1),0===selectedFilters[e].length&&delete selectedFilters[e]):selectedFilters[e].push(t);const o=document.getElementById("nav-tabContent");Array.from(o.children).forEach((e=>{const t=e.id.replace("list-","").replace(/-/g," ");e.classList.contains("active")&&populateTabValues(t,e)})),updateClearFiltersButtonStyle()}function applyFilters(){if(0===Object.keys(selectedFilters).length)return clearFilters(),void displayProducts(productsData.productDirectory);displayProducts(filterProductsBySelectedFilters(selectedFilters))}function clearFilters(){selectedFilters={},updateCheckboxStates(),updateClearFiltersButtonStyle(),displayProducts(productsData.productDirectory)}function filterProductsBySelectedFilters(e){return productsData.productDirectory.filter((t=>{for(const r in e)if(!e[r].includes(String(t[r])))return!1;return!0}))}function updateClearFiltersButtonStyle(){const e=document.getElementById("filterProductList"),t=document.getElementById("clearFilters");Object.keys(selectedFilters).length>0?(e.style.backgroundColor="darkblue",t.style.backgroundColor="black",t.style.color="white"):(e.style.backgroundColor="",t.style.backgroundColor="",t.style.color="")}let productsData,openedProductForOrder,currentFocusIndex=-1;async function loadProducts(){try{const e=await fetch("products.json");productsData=await e.json();displayProducts(productsData.productDirectory)}catch(e){console.error("Error loading products:",e)}}function displayProducts(e){const t=document.getElementById("product-list");t.innerHTML="";const r=document.createDocumentFragment();e.forEach((e=>{const t=document.createElement("li");t.classList.add("list-group-item","list-group-item-action"),t.setAttribute("data-bs-toggle","modal"),t.setAttribute("data-bs-target","#order-modal"),t.dataset.productName=e.Product,t.dataset.productType=e["Product Type"],t.dataset.productGroup=e["Group Name"],t.dataset.productGroupAlias=e["Group Alias"],t.dataset.productCategory=e["Prod. Category"],t.dataset.faceType=e["Face Type"],t.dataset.coreType=e["Core Type"],t.dataset.gradeType=e["Grade Type"],t.dataset.brandMark=e["Brand Mark"];const o=document.createElement("input");o.classList.add("form-check-input","me-2"),o.type="checkbox";const c=`checkbox-${e.Product.replace(/\s/g,"-")}`;o.id=c;const n=document.createElement("label");n.classList.add("form-check-label","fs-6","fw-semibold","stretched-link"),n.textContent=e.Product,n.setAttribute("for",c),t.appendChild(o),t.appendChild(n),t.onclick=()=>openOrderModal(t),r.appendChild(t)})),t.appendChild(r)}function openOrderModal(e){document.getElementById("modal-product-name").textContent=e.dataset.productName,document.getElementById("modal-product-type").innerHTML=`<b>Product Type :</b> ${e.dataset.productType}`,document.getElementById("modal-face-type").innerHTML=`<b>Face Type :</b> ${e.dataset.faceType}`,document.getElementById("modal-core-type").innerHTML=`<b>Core Type :</b> ${e.dataset.coreType}`,document.getElementById("modal-grade-type").innerHTML=`<b>Grade Type :</b> ${e.dataset.gradeType}`,document.getElementById("modal-brand-mark").innerHTML=`<b>Brand Mark :</b> ${e.dataset.brandMark}`,openedProductForOrder=e}document.addEventListener("keydown",(function(e){const t=document.getElementById("search-box"),r=document.getElementById("filter-modal"),o=document.getElementById("order-modal"),c=r.classList.contains("show"),n=o.classList.contains("show");if(c||n)n?/^[0-9]$/.test(e.key)?(e.preventDefault(),appendToQuantity(e.key)):"Backspace"===e.key?(e.preventDefault(),clearLastDigit()):"Delete"===e.key?(e.preventDefault(),document.getElementById("clearAllDigits").click()):"Enter"===e.key&&(e.preventDefault(),document.getElementById("addToOrder").click()):e.preventDefault();else{if(e.ctrlKey&&e.shiftKey&&"F"===e.key)return e.preventDefault(),void document.getElementById("filterProductList").click();if(e.ctrlKey&&e.shiftKey&&"O"===e.key)return e.preventDefault(),void document.getElementById("clearFilters").click();if(e.ctrlKey&&"Delete"===e.key)return e.preventDefault(),void clearOrder();if(e.ctrlKey&&"Enter"===e.key)return e.preventDefault(),void sendOrder();if(/^[a-zA-Z0-9]$/.test(e.key)){e.preventDefault();const r=t.selectionStart;t.focus(),t.value=t.value.slice(0,r)+e.key+t.value.slice(r),t.setSelectionRange(r+1,r+1);const o=new Event("input",{bubbles:!0});t.dispatchEvent(o)}if("Backspace"===e.key){e.preventDefault();const r=t.selectionStart;r>0&&(t.focus(),t.value=t.value.slice(0,r-1)+t.value.slice(r),t.setSelectionRange(r-1,r-1));const o=new Event("input",{bubbles:!0});t.dispatchEvent(o)}if("Delete"===e.key){e.preventDefault();const r=t.selectionStart;r<t.value.length&&(t.focus(),t.value=t.value.slice(0,r)+t.value.slice(r+1)),t.setSelectionRange(r,r);const o=new Event("input",{bubbles:!0});t.dispatchEvent(o)}const r=document.getElementById("product-list"),o=Array.from(r.children).filter((e=>"none"!==getComputedStyle(e).display));"ArrowDown"!==e.key&&"ArrowUp"!==e.key||(e.preventDefault(),"ArrowDown"===e.key&&(-1===currentFocusIndex?(currentFocusIndex=1,o[0]?.classList.add("focus"),o[0]?.scrollIntoView({block:"nearest"}),o[0]?.focus?.()):currentFocusIndex>0&&currentFocusIndex<=o.length&&(o[currentFocusIndex-1]?.classList.remove("focus"),currentFocusIndex<o.length&&(o[currentFocusIndex]?.classList.add("focus"),o[currentFocusIndex]?.scrollIntoView({block:"nearest"})),currentFocusIndex++)),"ArrowUp"===e.key&&(1===currentFocusIndex?(o[0]?.classList.remove("focus"),t.focus(),currentFocusIndex=-1):currentFocusIndex>1&&(o[currentFocusIndex-1]?.classList.remove("focus"),o[currentFocusIndex-2]?.classList.add("focus"),o[currentFocusIndex-2]?.scrollIntoView({block:"nearest"}),currentFocusIndex--))),"Enter"===e.key&&currentFocusIndex>0&&(e.preventDefault(),o[currentFocusIndex-1]?.click())}})),window.onload=loadProducts();let selectedProducts=[];const quantityInput=document.getElementById("quantity"),selectedProductsTextarea=document.getElementById("selected-products");function appendToQuantity(e){const t=document.getElementById("quantity");"0"===t.value?t.value=e:t.value+=e}function clearLastDigit(){const e=document.getElementById("quantity");let t=e.value;t.length>1?e.value=t.slice(0,-1):e.value="0"}function clearAllDigits(){document.getElementById("quantity").value="0"}function addToOrder(){const e=openedProductForOrder.dataset.productName,t=openedProductForOrder.dataset.productGroup,r=openedProductForOrder.dataset.productGroupAlias,o=openedProductForOrder.dataset.productCategory,c=parseInt(quantityInput.value,10),n=document.getElementById(`checkbox-${e.replace(/\s/g,"-")}`),a={productName:e,productGroup:t,productGroupAlias:r,productCategory:o,quantity:c};if(c>0){const t=selectedProducts.findIndex((t=>t.productName===e));t>-1?selectedProducts[t]=a:selectedProducts.push(a),n.checked=!0,clearAllDigits()}else selectedProducts=selectedProducts.filter((t=>t.productName!==e)),n.checked=!1;updateOrderList()}function clearOrder(){document.querySelectorAll('#product-list input[type="checkbox"]').forEach((e=>e.checked=!1)),selectedProducts=[],updateOrderList(),clearSearch()}function updateOrderList(){const e=selectedProducts.map((e=>`${e.productName} - ${e.quantity}`));selectedProductsTextarea.value=e.join("\n")+`\nTotal: ${calculateTotalQuantity()}`,selectedProductsTextarea.scrollTop=selectedProductsTextarea.scrollHeight}function calculateTotalQuantity(){return selectedProducts.reduce(((e,t)=>e+t.quantity),0)}const searchBox=document.getElementById("search-box");function scrollSearchBoxToTop(){const e=searchBox.getBoundingClientRect().top+window.scrollY-15;window.scrollTo({top:e,behavior:"smooth"})}function clearSearch(){searchBox.value="",filterProducts()}function filterProducts(){const e=searchBox.value.toUpperCase(),t=document.getElementById("product-list").getElementsByTagName("li");let r=!1;for(let o=0;o<t.length;o++){containsInOrder(t[o].dataset.productName.toUpperCase(),e)?(t[o].style.display="",r=!0):t[o].style.display="none"}if(!r)for(let r=0;r<t.length;r++){const o=t[r].dataset.brandMark?t[r].dataset.brandMark.toUpperCase():"",c=t[r].dataset.coreType?t[r].dataset.coreType.toUpperCase():"",n=t[r].dataset.gradeType?t[r].dataset.gradeType.toUpperCase():"";containsInOrder(o,e)||containsInOrder(c,e)||containsInOrder(n,e)?t[r].style.display="":t[r].style.display="none"}}function containsInOrder(e,t){e=e.toUpperCase(),t=t.toUpperCase();let r=0;for(let o=0;o<t.length;o++){if(r=e.indexOf(t[o],r),-1===r)return!1;r++}return!0}function sendOrder(){if(0===selectedProducts.length)return void console.warn("No products in the order. Please add products to the order.");selectedProducts.sort(((e,t)=>{const r=e.productGroupAlias.localeCompare(t.productGroupAlias);if(0===r){const r=e.productCategory.localeCompare(t.productCategory);return 0===r?e.productName.localeCompare(t.productName):r}return r}));let e="",t=null;selectedProducts.forEach((r=>{const{productGroupAlias:o,productName:c,productGroup:n}=r;t!==o&&(e+=`\n*${n}* :\n`,t=o),e+=`${c} - ${r.quantity}\n`}));let r=calculateTotalQuantity();e+=`\nTotal : *${r}* Pcs.\n`;const o=`https://wa.me/+916355360702?text=${encodeURIComponent(e)}`;window.open(o,"_blank")}searchBox.addEventListener("focus",(()=>{scrollSearchBoxToTop()})),searchBox.addEventListener("input",(()=>{scrollSearchBoxToTop()}));